(function(){"use strict";var e={5080:function(e,t,s){var o=s(9963),n=s(6252);function a(e,t,s,o,a,r){const i=(0,n.up)("router-view");return(0,n.wg)(),(0,n.j4)(i)}var r={name:"App"},i=s(3744);const c=(0,i.Z)(r,[["render",a]]);var u=c,d=s(5121),l=s(2201),p=s(3577);const h={key:0},m={style:{"background-color":"rgb(231, 231, 231)",width:"50%",height:"600px",margin:"auto"}},g=(0,n._)("h1",null,"Feed of discussion",-1),f={style:{height:"550px",overflow:"scroll","background-color":"rgb(231, 231, 231)"}},_={class:"box"},v={class:"exp"},y=["onUpdate:modelValue"],b={class:"foo"},w={class:"mesbox"},k={id:"inputs",class:"fs"},x=(0,n._)("fieldset",{id:"actions",class:"fs"},[(0,n._)("input",{type:"submit",id:"submit",value:"Envoyer",class:"envmes"})],-1);function O(e,t,s,a,r,i){return i.posts&&i.posts.items?((0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("div",m,[g,(0,n._)("div",f,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.posts.items,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.timestamp_utc_iso8601},[(0,n._)("div",_,[(0,n._)("div",v,(0,p.zw)(e.user_id)+" :",1),(0,n.wy)((0,n._)("textarea",{class:"mes","onUpdate:modelValue":t=>e.message=t},null,8,y),[[o.nr,e.message]])])])))),128))]),(0,n._)("button",{onClick:t[0]||(t[0]=(...e)=>i.nextMessages&&i.nextMessages(...e))},"more messages")]),(0,n._)("div",b,[(0,n._)("div",w,[(0,n._)("form",{onSubmit:t[2]||(t[2]=(0,o.iM)(((...e)=>i.handleSubmit&&i.handleSubmit(...e)),["prevent"]))},[(0,n._)("fieldset",k,[(0,n.wy)((0,n._)("textarea",{id:"message",name:"Message",placeholder:"Enter your message","onUpdate:modelValue":t[1]||(t[1]=e=>r.message=e),required:""},null,512),[[o.nr,r.message]])]),x],32)])])])):(0,n.kq)("",!0)}s(8858),s(1318),s(3228);var S=s(3907);const U=(0,S.MT)({state:{posts:[],id_token:void 0,access_token:void 0},getters:{getUser:e=>({id_token:e.id_token,access_token:e.access_token}),posts:e=>e.posts,isAuthenticated:e=>!!e.id_token},mutations:{LOGOUT(e){e.user=null},SET_USER(e,t){e.id_token=t.id_token,e.access_token=t.access_token},SET_ITEMS(e,t){e.posts=t}},actions:{async loadPosts({commit:e,getters:t},s){try{const o=await d.Z.get("/all-messages",{headers:{Authorization:`Bearer ${t.getUser.id_token}`},params:{cursor:s}});e("SET_ITEMS",o.data)}catch(o){alert("Failed to send request cause of :"+o),console.log(o)}},async LogOut({commit:e}){e("LOGOUT")},async addPost({dispatch:e,getters:t},s){const o=await e("loadUserId");await d.Z.post("/messages",{user_id:o,message:s.message},{headers:{Authorization:`Bearer ${t.getUser.id_token}`}})},async processCode({commit:e},t){const s=new URLSearchParams({grant_type:"authorization_code",client_id:"65ebu3b3qcvjci64if0n28l751",code:t.code,redirect_uri:encodeURI("https://di76j5myawn36.cloudfront.net/auth")});try{const t=await d.Z.post("https://havoc-messagerie.auth.eu-west-1.amazoncognito.com/oauth2/token",s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});e("SET_USER",{id_token:t.data.id_token,access_token:t.data.access_token})}catch(o){console.log("Erreur: ",o)}},async loadUserId({getters:e}){try{const t=await d.Z.get("https://havoc-messagerie.auth.eu-west-1.amazoncognito.com/oauth2/userInfo",{headers:{Authorization:`Bearer ${e.getUser.access_token}`}});return t.data.sub}catch(t){console.log("Erreur :",t)}}}});var j,E=U,T={name:"DiscussionBox",data(){return{user_id:"",message:""}},methods:{async handleSubmit(){try{await E.dispatch("addPost",{message:this.message}),this.message="",await E.dispatch("loadPosts")}catch(e){console.error("Error:",e.message||e)}},nextMessages(){j=this.posts.next_cursor,E.dispatch("loadPosts",j)}},computed:{posts(){const e=E.getters.posts;return e||{items:[]}}},async created(){await E.dispatch("loadPosts")}};const P=(0,i.Z)(T,[["render",O]]);var z=P;s(560);const A=(0,n._)("meta",{"http-equiv":"Content-Security-Policy",content:"default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"},null,-1),M=(0,n._)("h1",null,"Authentication in progress",-1),q=[A,M];var C={__name:"AuthBox",setup(e){return(0,n.bv)((()=>{(0,l.tv)().push("/")})),(e,t)=>((0,n.wg)(),(0,n.iD)("div",null,q))}};const I=C;var Z=I;const R=[{path:"/",name:"Home",component:z},{path:"/auth",name:"Auth",component:Z}],B=(0,l.p7)({history:(0,l.PO)(),routes:R});B.beforeEach((async(e,t,s)=>{const o=E.getters.isAuthenticated;if(o)s();else{const t=e.query.code;t&&!E.getters.getUser.id_token&&await E.dispatch("processCode",{code:t}),E.getters.isAuthenticated?s():window.location.href=`https://havoc-messagerie.auth.eu-west-1.amazoncognito.com/oauth2/authorize?client_id=65ebu3b3qcvjci64if0n28l751&response_type=code&scope=email+openid+phone&redirect_uri=${encodeURI("https://di76j5myawn36.cloudfront.net/auth")}`}}));var D=B;d.Z.defaults.baseURL="https://bbi3cqg9ld.execute-api.eu-west-1.amazonaws.com/test_hellolambda";const L=(0,o.ri)(u);L.use(D),L.use(E),L.mount("#app")}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,o,n,a){if(!o){var r=1/0;for(d=0;d<e.length;d++){o=e[d][0],n=e[d][1],a=e[d][2];for(var i=!0,c=0;c<o.length;c++)(!1&a||r>=a)&&Object.keys(s.O).every((function(e){return s.O[e](o[c])}))?o.splice(c--,1):(i=!1,a<r&&(r=a));if(i){e.splice(d--,1);var u=n();void 0!==u&&(t=u)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[o,n,a]}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,a,r=o[0],i=o[1],c=o[2],u=0;if(r.some((function(t){return 0!==e[t]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(c)var d=c(s)}for(t&&t(o);u<r.length;u++)a=r[u],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(d)},o=self["webpackChunkhavoc_project"]=self["webpackChunkhavoc_project"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[998],(function(){return s(5080)}));o=s.O(o)})();
//# sourceMappingURL=app.badcc86c.js.map